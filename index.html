<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>High Availability Jenkins Project by ericssonITTEcicontrib</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1 class="header">High Availability Jenkins Project</h1>
        <p class="header">HAJP Documentation</p>

        <ul>
          <li class="download"><a class="buttons" href="https://github.com/ericssonITTEcicontrib/hajp-doc/zipball/master">Download ZIP</a></li>
          <li class="download"><a class="buttons" href="https://github.com/ericssonITTEcicontrib/hajp-doc/tarball/master">Download TAR</a></li>
          <li><a class="buttons github" href="https://github.com/ericssonITTEcicontrib/hajp-doc">View On GitHub</a></li>
        </ul>

        <p class="header">This project is maintained by <a class="header name" href="https://github.com/ericssonITTEcicontrib">ericssonITTEcicontrib</a></p>


      </header>
      <section>
        <h1>
<a id="welcome-to-hajp-documentation" class="anchor" href="#welcome-to-hajp-documentation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Welcome to HAJP Documentation.</h1>

<p>High availability Jenkins plugin is an Ericsson open sourced product designed to make high availability Jenkins clustering a reality with fail over capabilities. Considering the complexity of Jenkins as a platform and critical nature of this plugin, we will implement the most stringent software development quality assurance protocols.</p>

<p><b> Table of Contents</b></p>

<ul>
<li><a href="#BusinessRequirements">Business Requirements</a></li>
<li>
<a href="#Lexicon">Lexicon</a>

<ul>
<li><a href="#ActiveMaster">Active Master</a></li>
<li><a href="#HotStandby">Hot Standby</a></li>
</ul>
</li>
<li>
<a href="#Architecture">Architecture</a>

<ul>
<li><a href="#DesignPrinciples">Design Principles</a></li>
</ul>
</li>
<li>
<a href="#AvailableFeatures">Available Features</a>

<ul>
<li><a href="#JobBuildSynchronization">Job and Build Synchronization</a></li>
<li><a href="#ClusterOperations">Cluster Operations</a></li>
</ul>
</li>
<li><a href="#InstallationInstructions">Installation Instructions</a></li>
<li>
<a href="#UserGuide">User Guide</a>

<ul>
<li><a href="#Configuration">Configuration</a></li>
</ul>
</li>
</ul>

<h2>
<a id="business-requirements-" class="anchor" href="#business-requirements-" aria-hidden="true"><span class="octicon octicon-link"></span></a>Business Requirements <a name="BusinessRequirements"></a>
</h2>

<p><b> Main requirement: transparent fail over if the Jenkins master becomes unavailable.</b></p>

<p>By transparent fail over we mean:</p>

<p>New builds will run without interruption (builds in progress are lost)
User (human, plugin, other tools) have access immediately to another master that provide the same information (i.e. mirror of one that is unavailable)/</p>

<p>By unavailability we mean:</p>

<p>Unplanned downtime, master not reachable.
Maintenance that require restart of master (core upgrade, plugin install/upgrade...). In such case fail over happen as soon the master cannot process new builds anymore (prepare for shutdown, restart).</p>

<p>Breakdown of main features</p>

<ul>
<li>High availability</li>
<li>Instant or near-instant fail over</li>
<li>Leader to cluster member replication of

<ul>
<li>Jobs</li>
<li>Builds</li>
<li>Users</li>
<li>Plugins</li>
<li>Global configuration</li>
</ul>
</li>
<li>Active proxy to Leader</li>
<li>Cluster health and status portal</li>
<li>Cluster control and reporting </li>
</ul>

<h2>
<a id="lexicon-" class="anchor" href="#lexicon-" aria-hidden="true"><span class="octicon octicon-link"></span></a>Lexicon <a name="Lexicon"></a>
</h2>

<h3>
<a id="active-master-" class="anchor" href="#active-master-" aria-hidden="true"><span class="octicon octicon-link"></span></a>Active Master <a name="ActiveMaster"></a>
</h3>

<p>Active Master (pronounciation /ˈaktiv 'mastər/) means a Jenkins Instance that is the real active instance
build operations are taking place. </p>

<p>With our current architecture, there can be ONLY ONE Active Master at any time in a HAJP cluster.</p>

<h3>
<a id="hot-standby-" class="anchor" href="#hot-standby-" aria-hidden="true"><span class="octicon octicon-link"></span></a>Hot Standby <a name="HotStandby"></a>
</h3>

<p>Hot Standby (pronounciation /hät ˈstan(d)ˌbī/) means a Jenkins Instance that can not instantiate or run
build operations. It will receive synchronization from Active Master in the cluster and wait for a potential
fail over scenario to occur, becoming Active Master if elected.</p>

<p>With our current architecture, there can be many Hot Standby at any time in a HAJP cluster. Our recommended
deployment involves at least 1-2 Hot Standby Jenkins instances to eliminate potential fail over errors.</p>

<h2>
<a id="architecture-" class="anchor" href="#architecture-" aria-hidden="true"><span class="octicon octicon-link"></span></a>Architecture <a name="Architecture"></a>
</h2>

<p>Jenkins is a distributed project build processing system at heart with quite a number of community and CloudBees developed plugins. As it grew overtime from its Hudson roots, Jenkins took an almost organic path making certain types of operations a breeze and other types of operations virtually impossible.</p>

<p>HAJP 2.0 is built on a synchronized cluster with a single active master (referred as Leader) at any given time with many hot-standby masters and many slave instances.</p>

<h3>
<a id="design-principles-" class="anchor" href="#design-principles-" aria-hidden="true"><span class="octicon octicon-link"></span></a>Design Principles <a name="DesignPrinciples"></a>
</h3>

<ul>
<li>No single point of failure</li>
<li>Unidirectional communication</li>
<li>Instant or near instant fail over</li>
<li>Only synchronize what could be synchronized with zero failure</li>
<li>Minimalist -- avoid accidental complexity</li>
</ul>

<h2>
<a id="available-features-" class="anchor" href="#available-features-" aria-hidden="true"><span class="octicon octicon-link"></span></a>Available Features <a name="AvailableFeatures"></a>
</h2>

<p>We are continually adding new features to HAJP, please stay tuned. </p>

<h3>
<a id="job-and-build-synchronization-" class="anchor" href="#job-and-build-synchronization-" aria-hidden="true"><span class="octicon octicon-link"></span></a>Job and Build Synchronization <a name="JobBuildSynchronization"></a>
</h3>

<p><img src="http://i62.tinypic.com/fenoyq.jpg"></p>

<h3>
<a id="cluster-operations-" class="anchor" href="#cluster-operations-" aria-hidden="true"><span class="octicon octicon-link"></span></a>Cluster Operations <a name="ClusterOperations"></a>
</h3>

<p><img src="http://i59.tinypic.com/2aj3xwl.jpg"></p>

<h2>
<a id="installation-instructions-" class="anchor" href="#installation-instructions-" aria-hidden="true"><span class="octicon octicon-link"></span></a>Installation Instructions <a name="InstallationInstructions"></a>
</h2>

<p>Assuming a TOMCAT deployment, these jar files must be placed under TOMCAT/lib as managed dependencies for hpi to work correctly when built from a cloned repo instance.
Otherwise these jars must be moved pre-packaging to hpi within TARGET folder.</p>

<p>akka-actor_2.11-2.3.9.jar
akka-cluster_2.11-2.3.9.jar
akka-remote_2.11-2.3.9.jar
hajp-common-1.0.5.jar
config-1.2.1.jar
netty-3.8.0.Final.jar
protobuf-java-2.5.0.jar
scala-library-2.11.5.jar
slf4j-api-1.7.7.jar</p>

<h1>
<a id="user-guide-" class="anchor" href="#user-guide-" aria-hidden="true"><span class="octicon octicon-link"></span></a>User Guide <a name="UserGuide"></a>
</h1>

<p>High Availability Jenkins Project is about creating a fail-over capable cluster of Jenkins instances with selective synchronization
, monitoring and control capabilities.</p>

<p>Configuration is described below with annotated images. First Jenkins instance to join the cluster becomes Active Master
while all others become Hot Standby members. </p>

<p>When a fail-over occurs, a new Active Master is elected from remaining Hot Standby members.</p>

<p>a Vagrant file is provided for testing purposes... it needs Vagrant version &gt; 1.7.0 and VirtualBox of version 4.3 and above.
<a href="https://raw.githubusercontent.com/danielyinanc/hajp-test/develop/functional/deploy/vagrant/Vagrantfile">VagrantFile</a></p>

<p>All that is required for deployment (assuming Vagrant and VirtualBox is installed in the system) is to run the following 
command at the same folder with Vagrantfile downloaded above</p>

<pre><code>vagrant up
</code></pre>

<p>Vagrant installation tutorials: </p>

<p><a href="http://code.tutsplus.com/tutorials/vagrant-what-why-and-how--net-26500">Tutsplus Tutorial</a>
<a href="http://docs.vagrantup.com/v2/getting-started/">Vagrant Getting Started</a></p>

<h2>
<a id="configuration-" class="anchor" href="#configuration-" aria-hidden="true"><span class="octicon octicon-link"></span></a>Configuration <a name="Configuration"></a>
</h2>

<p>After launching the Jenkins instance, please click manage jenkins on left corner of screen.</p>

<p><img src="http://i62.tinypic.com/25flv1l.jpg"></p>

<p>HAJP-Settings button is among other buttons on the right side of the screen. </p>

<p><img src="http://i61.tinypic.com/8wzc3s.jpg"></p>

<p>This setup information is taken to match Vagrant file provided for testing purposes <a href="https://raw.githubusercontent.com/danielyinanc/hajp-test/develop/functional/deploy/vagrant/Vagrantfile">VagrantFile</a>. 
Other than IP ranges, same configuration steps are applicable for any HAJP installation.</p>

<h3>
<a id="empty-settings-page-" class="anchor" href="#empty-settings-page-" aria-hidden="true"><span class="octicon octicon-link"></span></a>Empty settings page <a name="EmptySettings"></a>
</h3>

<p><img src="http://i59.tinypic.com/x393jq.jpg"></p>

<h3>
<a id="ipfinder-output" class="anchor" href="#ipfinder-output" aria-hidden="true"><span class="octicon octicon-link"></span></a>ipFinder output</h3>

<p>Use the following settings</p>

<ul>
<li>172.17.0.1 as Orchestrator IP</li>
<li>172.17.0.2 as Core1 (port 9080)</li>
<li>172.17.0.3 as Core2 (port 9081)</li>
<li>For convenience please use port 2551 for all components.</li>
</ul>

<p><img src="http://i62.tinypic.com/2rnze4h.jpg"></p>

<h3>
<a id="jenkins-instance-1-port-9080-settings-filled" class="anchor" href="#jenkins-instance-1-port-9080-settings-filled" aria-hidden="true"><span class="octicon octicon-link"></span></a>Jenkins Instance 1 (port 9080) Settings Filled</h3>

<p><img src="http://i57.tinypic.com/s6p2xv.jpg"></p>

<h3>
<a id="jenkins-instance-2-port-9081-settings-filled" class="anchor" href="#jenkins-instance-2-port-9081-settings-filled" aria-hidden="true"><span class="octicon octicon-link"></span></a>Jenkins Instance 2 (port 9081) Settings Filled</h3>

<p><img src="http://i58.tinypic.com/2u4src1.jpg"></p>

<h3>
<a id="jenkins-instance-1-becomes-active-master" class="anchor" href="#jenkins-instance-1-becomes-active-master" aria-hidden="true"><span class="octicon octicon-link"></span></a>Jenkins Instance 1 becomes Active Master</h3>

<p>After the settings are entered, wait for about 10 seconds and reload 
settings page to see Jenkins Instance 1 becoming Active Master.</p>

<p><img src="http://i57.tinypic.com/20gla4o.jpg"></p>

<h3>
<a id="jenkins-instance-2-becomes-hot-standby" class="anchor" href="#jenkins-instance-2-becomes-hot-standby" aria-hidden="true"><span class="octicon octicon-link"></span></a>Jenkins Instance 2 becomes Hot Standby</h3>

<p>After the settings are entered, wait for about 10 seconds and reload 
settings page to see Jenkins Instance 2 becoming Hot Standby.</p>

<p>Please note that first time this operation takes place, Jenkins instance
will restart due to Hot Standby receiving keys and secrets from Active Master.
Once restart is completed, you can repeat the operation and this time Jenkins
Instance 2 becomes a Hot Standby.</p>

<p>This restart is due to a Jenkins limitation. Secrets, identities and keys are generated
for each Jenkins instance during first start-up phase and must be synchronized (which requires
a restart) for Hot Standby to act like Active Master when fail over occurs.</p>

<p><img src="http://i57.tinypic.com/2vhyarr.jpg"></p>
      </section>
      <footer>
        <p><small>Hosted on <a href="https://pages.github.com">GitHub Pages</a> using the Dinky theme</small></p>
      </footer>
    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
		
  </body>
</html>
