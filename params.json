{"name":"High Availability Jenkins Project","tagline":"HAJP Documentation","body":"# Welcome to HAJP Documentation.\r\nHigh availability Jenkins plugin is an Ericsson open sourced product designed to make high availability Jenkins clustering a reality with fail over capabilities. Considering the complexity of Jenkins as a platform and critical nature of this plugin, we will implement the most stringent software development quality assurance protocols.\r\n\r\n<b> Table of Contents\r\n* [Business Requirements](#BusinessRequirements)\r\n* [Lexicon](#Lexicon)\r\n   * [Active Master](#ActiveMaster)\r\n   * [Hot Standby](#HotStandby)\r\n   * [Global Config](#GlobalConfiguration)\r\n* [Architecture](#Architecture)\r\n    * [Design Principles](#DesignPrinciples)\r\n* [Available Features](#AvailableFeatures)\r\n    * [Job and Build Synchronization](#JobBuildSynchronization)\r\n    * [Cluster Operations](#ClusterOperations)\r\n* [Installation Instructions](#InstallationInstructions)\r\n* [User Guide](#UserGuide)\r\n    * [Configuration](#Configuration)\r\n\r\n## Business Requirements <a name=\"BusinessRequirements\"></a>\r\n\r\n<b> Main requirement: transparent fail over if the Jenkins master becomes unavailable.\r\n\r\nBy transparent fail over we mean:\r\n\r\nNew builds will run without interruption (builds in progress are lost)\r\nUser (human, plugin, other tools) have access immediately to another master that provide the same information (i.e. mirror of one that is unavailable)/\r\n\r\nBy unavailability we mean:\r\n\r\nUnplanned downtime, master not reachable.\r\nMaintenance that require restart of master (core upgrade, plugin install/upgrade...). In such case fail over happen as soon the master cannot process new builds anymore (prepare for shutdown, restart).\r\n\r\nBreakdown of main features\r\n\r\n* High availability\r\n* Instant or near-instant fail over\r\n* Leader to cluster member replication of\r\n  * Jobs\r\n  * Builds\r\n  * Users\r\n  * Plugins\r\n  * Global configuration\r\n* Active proxy to Leader\r\n* Cluster health and status portal\r\n* Cluster control and reporting \r\n\r\n## Lexicon <a name=\"Lexicon\"></a>\r\n\r\n### Active Master <a name=\"ActiveMaster\"></a>\r\nActive Master (pronounciation /ˈaktiv 'mastər/) means a Jenkins Instance that is the real active instance\r\nbuild operations are taking place. \r\n\r\nWith our current architecture, there can be ONLY ONE Active Master at any time in a HAJP cluster.\r\n\r\n### Hot Standby <a name=\"HotStandby\"></a>\r\nHot Standby (pronounciation /hät ˈstan(d)ˌbī/) means a Jenkins Instance that can not instantiate or run\r\nbuild operations. It will receive synchronization from Active Master in the cluster and wait for a potential\r\nfail over scenario to occur, becoming Active Master if elected.\r\n\r\nWith our current architecture, there can be many Hot Standby at any time in a HAJP cluster. Our recommended\r\ndeployment involves at least 1-2 Hot Standby Jenkins instances to eliminate potential fail over errors.\r\n\r\n### Global Configuration <a name=\"GlobalConfiguration\"></a>\r\nBy Global Configuration, we mean configuration elements that belong to Jenkins core only and are\r\nreplicable via file transfer and reload. \r\n\r\nFull list is here:\r\n\r\n| Element        | Result       | \r\n| ------------- |:-------------:|\r\n| Workspace Root Directory      | OK      |\r\n| Build Record Root Directory   | OK    |\r\n| System Message | OK      |\r\n| # of executors | OK      |\r\n| Labels | OK      |\r\n| Usage | OK      |\r\n| Quiet period | OK      |\r\n| SCM checkout retry count | OK      |\r\n| Restrict project naming (all fields) | OK      |\r\n| Environment variables | OK      |\r\n| add tool locations | OK      |\r\n| JDK (all fields) | OK      |\r\n\r\nAny other configuration element on Manage Jenkins or configuration tabs can be assumed to\r\nrequire manual synchronization between Active Master and Hot Standby(s).\r\n\r\n## Architecture <a name=\"Architecture\"></a>\r\n\r\nJenkins is a distributed project build processing system at heart with quite a number of community and CloudBees developed plugins. As it grew overtime from its Hudson roots, Jenkins took an almost organic path making certain types of operations a breeze and other types of operations virtually impossible.\r\n\r\nHAJP 2.0 is built on a synchronized cluster with a single active master (referred as Leader) at any given time with many hot-standby masters and many slave instances.\r\n\r\n### Design Principles <a name=\"DesignPrinciples\"></a>\r\n\r\n* No single point of failure\r\n* Unidirectional communication\r\n* Instant or near instant fail over\r\n* Only synchronize what could be synchronized with zero failure\r\n* Minimalist -- avoid accidental complexity\r\n\r\n\r\n## Available Features <a name=\"AvailableFeatures\"></a>\r\nWe are continually adding new features to HAJP, please stay tuned. \r\n\r\n### Job and Build Synchronization <a name=\"JobBuildSynchronization\"></a>\r\n<img src=\"http://i62.tinypic.com/fenoyq.jpg\">\r\n\r\n### Cluster Operations <a name=\"ClusterOperations\"></a>\r\n<img src=\"http://i59.tinypic.com/2aj3xwl.jpg\">\r\n\r\n\r\n## Installation Instructions <a name=\"InstallationInstructions\"></a>\r\n\r\nAssuming a TOMCAT deployment, these jar files must be placed under TOMCAT/lib as managed dependencies for hpi to work correctly when built from a cloned repo instance.\r\nOtherwise these jars must be moved pre-packaging to hpi within TARGET folder.\r\n\r\nakka-actor_2.11-2.3.9.jar\r\nakka-cluster_2.11-2.3.9.jar\r\nakka-remote_2.11-2.3.9.jar\r\nhajp-common-1.0.5.jar\r\nconfig-1.2.1.jar\r\nnetty-3.8.0.Final.jar\r\nprotobuf-java-2.5.0.jar\r\nscala-library-2.11.5.jar\r\nslf4j-api-1.7.7.jar\r\n\r\n\r\n# User Guide <a name=\"UserGuide\"></a>\r\nHigh Availability Jenkins Project is about creating a fail-over capable cluster of Jenkins instances with selective synchronization\r\n, monitoring and control capabilities.\r\n\r\nConfiguration is described below with annotated images. First Jenkins instance to join the cluster becomes Active Master\r\nwhile all others become Hot Standby members. \r\n\r\nWhen a fail-over occurs, a new Active Master is elected from remaining Hot Standby members.\r\n\r\na Vagrant file is provided for testing purposes... it needs Vagrant version > 1.7.0 and VirtualBox of version 4.3 and above.\r\n[VagrantFile](https://raw.githubusercontent.com/danielyinanc/hajp-test/develop/functional/deploy/vagrant/Vagrantfile)\r\n\r\nAll that is required for deployment (assuming Vagrant and VirtualBox is installed in the system) is to run the following \r\ncommand at the same folder with Vagrantfile downloaded above\r\n \r\n    vagrant up\r\n\r\nVagrant installation tutorials: \r\n\r\n[Tutsplus Tutorial](http://code.tutsplus.com/tutorials/vagrant-what-why-and-how--net-26500)\r\n[Vagrant Getting Started](http://docs.vagrantup.com/v2/getting-started/)\r\n\r\n\r\n\r\n##Configuration <a name=\"Configuration\"></a>\r\nAfter launching the Jenkins instance, please click manage jenkins on left corner of screen.\r\n\r\n<img src=\"http://i62.tinypic.com/25flv1l.jpg\">\r\n\r\nHAJP-Settings button is among other buttons on the right side of the screen. \r\n\r\n<img src=\"http://i61.tinypic.com/8wzc3s.jpg\">\r\n\r\nThis setup information is taken to match Vagrant file provided for testing purposes [VagrantFile](https://raw.githubusercontent.com/danielyinanc/hajp-test/develop/functional/deploy/vagrant/Vagrantfile). \r\nOther than IP ranges, same configuration steps are applicable for any HAJP installation.\r\n\r\n### Empty settings page <a name=\"EmptySettings\"></a>\r\n<img src=\"http://i59.tinypic.com/x393jq.jpg\">\r\n\r\n### ipFinder output\r\nUse the following settings\r\n\r\n* 172.17.0.1 as Orchestrator IP\r\n* 172.17.0.2 as Core1 (port 9080)\r\n* 172.17.0.3 as Core2 (port 9081)\r\n* For convenience please use port 2551 for all components.\r\n\r\n<img src=\"http://i62.tinypic.com/2rnze4h.jpg\">\r\n\r\n### Jenkins Instance 1 (port 9080) Settings Filled\r\n<img src=\"http://i57.tinypic.com/s6p2xv.jpg\">\r\n\r\n### Jenkins Instance 2 (port 9081) Settings Filled\r\n<img src=\"http://i58.tinypic.com/2u4src1.jpg\">\r\n\r\n### Jenkins Instance 1 becomes Active Master\r\nAfter the settings are entered, wait for about 10 seconds and reload \r\nsettings page to see Jenkins Instance 1 becoming Active Master.\r\n\r\n<img src=\"http://i57.tinypic.com/20gla4o.jpg\">\r\n\r\n### Jenkins Instance 2 becomes Hot Standby\r\nAfter the settings are entered, wait for about 10 seconds and reload \r\nsettings page to see Jenkins Instance 2 becoming Hot Standby.\r\n\r\nPlease note that first time this operation takes place, Jenkins instance\r\nwill restart due to Hot Standby receiving keys and secrets from Active Master.\r\nOnce restart is completed, you can repeat the operation and this time Jenkins\r\nInstance 2 becomes a Hot Standby.\r\n\r\nThis restart is due to a Jenkins limitation. Secrets, identities and keys are generated\r\nfor each Jenkins instance during first start-up phase and must be synchronized (which requires\r\na restart) for Hot Standby to act like Active Master when fail over occurs.\r\n\r\n<img src=\"http://i57.tinypic.com/2vhyarr.jpg\">\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}